{"name":"silverbullet-backlinks","version":0.3,"assets":{"style.css":"data:text/css;base64,Ym9keSB7CiAgZm9udC1mYW1pbHk6IGdlb3JnaWEsdGltZXMsc2VyaWY7CiAgZm9udC1zaXplOiAxNHB0OwogIHdpZHRoOiAxMDAlOwogIG1hcmdpbi1sZWZ0OiBhdXRvOwogIG1hcmdpbi1yaWdodDogYXV0bzsKICBwYWRkaW5nLWxlZnQ6IDIwcHg7CiAgcGFkZGluZy1yaWdodDogMjBweDsKfQoKdGFibGUgewogIHdpZHRoOiAxMDAlOwogIGJvcmRlci1zcGFjaW5nOiAwOwp9Cgp1bCB7CiAgbWFyZ2luLWxlZnQ6IDA7CiAgcGFkZGluZy1sZWZ0OiAwOwp9CgpsaSB7CiAgbGlzdC1zdHlsZTogbm9uZTsKfQoKdGhlYWQgdHIgewogICAgYmFja2dyb3VuZC1jb2xvcjogIzMzMzsKICAgIGNvbG9yOiAjZWVlOwp9Cgp0aCwgdGQgewogICAgcGFkZGluZzogOHB4Owp9Cgp0Ym9keSB0cjpudGgtb2YtdHlwZShldmVuKSB7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjNmM2YzOwp9CgphW2hyZWZdIHsKICB0ZXh0LWRlY29yYXRpb246IG5vbmU7Cn0KCmJsb2NrcXVvdGUgewogIGJvcmRlci1sZWZ0OiAxcHggc29saWQgIzMzMzsKICBtYXJnaW4tbGVmdDogMnB4OwogIHBhZGRpbmctbGVmdDogMTBweDsKfQoKaHIgewogICAgbWFyZ2luOiAxZW0gMCAxZW0gMDsKICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgIGJvcmRlci1jb2xvcjogIzc3NzsKICAgIGJvcmRlci13aWR0aDogMDsKICAgIGJvcmRlci1zdHlsZTogZG90dGVkOwp9CgpocjphZnRlciB7CiAgICBjb250ZW50OiAiwrfCt8K3IjsKICAgIGxldHRlci1zcGFjaW5nOiAxZW07Cn0KCnNwYW4ud2lraS1saW5rIHsKCiAgY3Vyc29yOiBwb2ludGVyOwogIGNvbG9yOiAjYThhYmJkOwp9CgpzcGFuLndpa2ktbGluay1wYWdlIHsKICBjb2xvcjogIzAzMzBjYjsKICBjdXJzb3I6IHBvaW50ZXI7CiAgYmFja2dyb3VuZC1jb2xvcjogIzRkOGRmZjEyOwogIGJvcmRlci1yYWRpdXM6IDVweDsKICBwYWRkaW5nOiAwIDVweDsKfQ=="},"functions":{"toggle":{"command":{"name":"Show Backlinks for current page","key":"ctrl-shift-b","mac":"Cmd-shift-b"},"code":"(() => { var mod=(()=>{var g=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var v=Object.getOwnPropertyNames;var k=Object.prototype.hasOwnProperty;var a=(e,t)=>{for(var n in t)g(e,n,{get:t[n],enumerable:!0})},b=(e,t,n,o)=>{if(t&&typeof t==\"object\"||typeof t==\"function\")for(let i of v(t))!k.call(e,i)&&i!==n&&g(e,i,{get:()=>t[i],enumerable:!(o=h(t,i))||o.enumerable});return e};var w=e=>b(g({},\"__esModule\",{value:!0}),e);var he={};a(he,{default:()=>ye});var c={};a(c,{readAsset:()=>A});function f(e){let t=atob(e),n=t.length,o=new Uint8Array(n);for(let i=0;i<n;i++)o[i]=t.charCodeAt(i);return o}var s=self.syscall;async function A(e,t=\"utf8\"){let n=await s(\"asset.readAsset\",e);switch(t){case\"utf8\":return new TextDecoder().decode(f(n.split(\",\")[1]));case\"dataurl\":return n}}var l={};a(l,{del:()=>D,get:()=>E,set:()=>T});typeof self>\"u\"&&(self={syscall:()=>{throw new Error(\"Not implemented here\")}});var r=self.syscall;function T(e,t){return r(\"clientStore.set\",e,t)}function E(e){return r(\"clientStore.get\",e)}function D(e){return r(\"clientStore.delete\",e)}var u={};a(u,{dispatch:()=>Z,enableReadOnlyMode:()=>ee,filterBox:()=>z,flashNotification:()=>j,getCurrentPage:()=>N,getCursor:()=>I,getSelection:()=>U,getText:()=>q,hidePanel:()=>G,insertAtCursor:()=>X,insertAtPos:()=>H,matchBefore:()=>Y,moveCursor:()=>W,navigate:()=>R,openUrl:()=>Q,prompt:()=>_,reloadPage:()=>V,replaceRange:()=>J,save:()=>O,setPage:()=>$,setSelection:()=>K,showPanel:()=>p});function N(){return r(\"editor.getCurrentPage\")}function $(e){return r(\"editor.setPage\",e)}function q(){return r(\"editor.getText\")}function I(){return r(\"editor.getCursor\")}function U(){return r(\"editor.getSelection\")}function K(e,t){return r(\"editor.setSelection\",e,t)}function O(){return r(\"editor.save\")}function R(e,t,n=!1){return r(\"editor.navigate\",e,t,n)}function V(){return r(\"editor.reloadPage\")}function Q(e){return r(\"editor.openUrl\",e)}function j(e,t=\"info\"){return r(\"editor.flashNotification\",e,t)}function z(e,t,n=\"\",o=\"\"){return r(\"editor.filterBox\",e,t,n,o)}function p(e,t,n,o=\"\"){return r(\"editor.showPanel\",e,t,n,o)}function G(e){return r(\"editor.hidePanel\",e)}function H(e,t){return r(\"editor.insertAtPos\",e,t)}function J(e,t,n){return r(\"editor.replaceRange\",e,t,n)}function W(e){return r(\"editor.moveCursor\",e)}function X(e){return r(\"editor.insertAtCursor\",e)}function Y(e){return r(\"editor.matchBefore\",e)}function Z(e){return r(\"editor.dispatch\",e)}function _(e,t=\"\"){return r(\"editor.prompt\",e,t)}function ee(e){return r(\"editor.enableReadOnlyMode\",e)}var m={};a(m,{batchSet:()=>re,clearPageIndex:()=>ue,clearPageIndexForPage:()=>ae,del:()=>oe,deletePrefixForPage:()=>le,get:()=>ne,query:()=>se,queryPrefix:()=>ie,set:()=>te});function te(e,t,n){return r(\"index.set\",e,t,n)}function re(e,t){return r(\"index.batchSet\",e,t)}function ne(e,t){return r(\"index.get\",e,t)}function oe(e,t){return r(\"index.delete\",e,t)}function ie(e){return r(\"index.queryPrefix\",e)}function se(e){return r(\"index.query\",e)}function ae(e){return r(\"index.clearPageIndexForPage\",e)}function le(e,t){return r(\"index.deletePrefixForPage\",e,t)}function ue(){return r(\"index.clearPageIndex\")}var d=\"showBacklinks\";async function x(){let e=await P();if(await l.set(d,!e),e)await u.hidePanel(\"lhs\");else{let t=await u.getCurrentPage();await de(t)}}var fe=`\n  function processClick(e) {\n    let pageName = e.currentTarget.getAttribute('data-page');\n    if (!pageName) {\n      console.log('no page value for:');\n      console.log(e);\n      pageName = '';\n    }\n    removeListeners();\n    // send an event so the navigation happens internally preventing a full page reload\n    sendEvent('backlink:navigateTo', pageName);\n  }\n\n  function getLinks() {\n    return Array.from(document.getElementsByTagName('li'));\n  }\n  // remove listeners once we are done\n  function removeListeners() {\n    const links = getLinks();\n    links.forEach((item) => item.removeEventListener('click', processClick));\n  }\n\n  // make li tags clickable\n  const linkList = getLinks();\n  linkList.forEach((item) => item.addEventListener('click', processClick));\n`;async function de(e){if(await P()){let t=await xe(e),n=await c.readAsset(\"style.css\"),o=t.length===0?\"No links found\":Pe(t);await p(\"lhs\",.5,`<html><head><style>${n}</style></head><body>\n        <h2>Backlinks</h2>\n        <ul>\n        ${o}\n        </ul>\n        </body></html>`,fe)}}async function P(){return!!await l.get(d)}async function xe(e){return(await m.queryPrefix(`pl:${e}:`)).map(({page:o,key:i})=>{let[,,y]=i.split(\":\");return`${o}@${y}`})}function Pe(e){return e.map(n=>`<li data-page=\"${n}\">\\u{1F587}\\uFE0F&nbsp;<span class=\"wiki-link\">[[</span><span class=\"wiki-link-page\">${n}</span><span class=\"wiki-link\">]]</span></li>`).join(\"\")}var ye=x;return w(he);})();\n return mod;})()"},"updateBacklinks":{"env":"client","events":["plug:load","editor:pageLoaded"],"code":"(() => { var mod=(()=>{var g=Object.defineProperty;var P=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var h=Object.prototype.hasOwnProperty;var a=(e,t)=>{for(var n in t)g(e,n,{get:t[n],enumerable:!0})},v=(e,t,n,o)=>{if(t&&typeof t==\"object\"||typeof t==\"function\")for(let i of y(t))!h.call(e,i)&&i!==n&&g(e,i,{get:()=>t[i],enumerable:!(o=P(t,i))||o.enumerable});return e};var k=e=>v(g({},\"__esModule\",{value:!0}),e);var he={};a(he,{default:()=>ye});var l={};a(l,{readAsset:()=>b});function f(e){let t=atob(e),n=t.length,o=new Uint8Array(n);for(let i=0;i<n;i++)o[i]=t.charCodeAt(i);return o}var s=self.syscall;async function b(e,t=\"utf8\"){let n=await s(\"asset.readAsset\",e);switch(t){case\"utf8\":return new TextDecoder().decode(f(n.split(\",\")[1]));case\"dataurl\":return n}}var u={};a(u,{del:()=>T,get:()=>S,set:()=>B});typeof self>\"u\"&&(self={syscall:()=>{throw new Error(\"Not implemented here\")}});var r=self.syscall;function B(e,t){return r(\"clientStore.set\",e,t)}function S(e){return r(\"clientStore.get\",e)}function T(e){return r(\"clientStore.delete\",e)}var c={};a(c,{dispatch:()=>X,enableReadOnlyMode:()=>Z,filterBox:()=>Q,flashNotification:()=>V,getCurrentPage:()=>E,getCursor:()=>$,getSelection:()=>q,getText:()=>N,hidePanel:()=>j,insertAtCursor:()=>J,insertAtPos:()=>z,matchBefore:()=>W,moveCursor:()=>H,navigate:()=>K,openUrl:()=>R,prompt:()=>Y,reloadPage:()=>O,replaceRange:()=>G,save:()=>U,setPage:()=>D,setSelection:()=>I,showPanel:()=>p});function E(){return r(\"editor.getCurrentPage\")}function D(e){return r(\"editor.setPage\",e)}function N(){return r(\"editor.getText\")}function $(){return r(\"editor.getCursor\")}function q(){return r(\"editor.getSelection\")}function I(e,t){return r(\"editor.setSelection\",e,t)}function U(){return r(\"editor.save\")}function K(e,t,n=!1){return r(\"editor.navigate\",e,t,n)}function O(){return r(\"editor.reloadPage\")}function R(e){return r(\"editor.openUrl\",e)}function V(e,t=\"info\"){return r(\"editor.flashNotification\",e,t)}function Q(e,t,n=\"\",o=\"\"){return r(\"editor.filterBox\",e,t,n,o)}function p(e,t,n,o=\"\"){return r(\"editor.showPanel\",e,t,n,o)}function j(e){return r(\"editor.hidePanel\",e)}function z(e,t){return r(\"editor.insertAtPos\",e,t)}function G(e,t,n){return r(\"editor.replaceRange\",e,t,n)}function H(e){return r(\"editor.moveCursor\",e)}function J(e){return r(\"editor.insertAtCursor\",e)}function W(e){return r(\"editor.matchBefore\",e)}function X(e){return r(\"editor.dispatch\",e)}function Y(e,t=\"\"){return r(\"editor.prompt\",e,t)}function Z(e){return r(\"editor.enableReadOnlyMode\",e)}var m={};a(m,{batchSet:()=>ee,clearPageIndex:()=>ae,clearPageIndexForPage:()=>ie,del:()=>re,deletePrefixForPage:()=>se,get:()=>te,query:()=>oe,queryPrefix:()=>ne,set:()=>_});function _(e,t,n){return r(\"index.set\",e,t,n)}function ee(e,t){return r(\"index.batchSet\",e,t)}function te(e,t){return r(\"index.get\",e,t)}function re(e,t){return r(\"index.delete\",e,t)}function ne(e){return r(\"index.queryPrefix\",e)}function oe(e){return r(\"index.query\",e)}function ie(e){return r(\"index.clearPageIndexForPage\",e)}function se(e,t){return r(\"index.deletePrefixForPage\",e,t)}function ae(){return r(\"index.clearPageIndex\")}var ge=\"showBacklinks\";async function d(){let e=await c.getCurrentPage();await fe(e)}var pe=`\n  function processClick(e) {\n    let pageName = e.currentTarget.getAttribute('data-page');\n    if (!pageName) {\n      console.log('no page value for:');\n      console.log(e);\n      pageName = '';\n    }\n    removeListeners();\n    // send an event so the navigation happens internally preventing a full page reload\n    sendEvent('backlink:navigateTo', pageName);\n  }\n\n  function getLinks() {\n    return Array.from(document.getElementsByTagName('li'));\n  }\n  // remove listeners once we are done\n  function removeListeners() {\n    const links = getLinks();\n    links.forEach((item) => item.removeEventListener('click', processClick));\n  }\n\n  // make li tags clickable\n  const linkList = getLinks();\n  linkList.forEach((item) => item.addEventListener('click', processClick));\n`;async function fe(e){if(await de()){let t=await xe(e),n=await l.readAsset(\"style.css\"),o=t.length===0?\"No links found\":Pe(t);await p(\"lhs\",.5,`<html><head><style>${n}</style></head><body>\n        <h2>Backlinks</h2>\n        <ul>\n        ${o}\n        </ul>\n        </body></html>`,pe)}}async function de(){return!!await u.get(ge)}async function xe(e){return(await m.queryPrefix(`pl:${e}:`)).map(({page:o,key:i})=>{let[,,x]=i.split(\":\");return`${o}@${x}`})}function Pe(e){return e.map(n=>`<li data-page=\"${n}\">\\u{1F587}\\uFE0F&nbsp;<span class=\"wiki-link\">[[</span><span class=\"wiki-link-page\">${n}</span><span class=\"wiki-link\">]]</span></li>`).join(\"\")}var ye=d;return k(he);})();\n return mod;})()"},"navigateTo":{"events":["backlink:navigateTo"],"code":"(() => { var mod=(()=>{var l=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var x=Object.getOwnPropertyNames;var P=Object.prototype.hasOwnProperty;var u=(e,r)=>{for(var n in r)l(e,n,{get:r[n],enumerable:!0})},y=(e,r,n,o)=>{if(r&&typeof r==\"object\"||typeof r==\"function\")for(let s of x(r))!P.call(e,s)&&s!==n&&l(e,s,{get:()=>r[s],enumerable:!(o=d(r,s))||o.enumerable});return e};var v=e=>y(l({},\"__esModule\",{value:!0}),e);var Z={};u(Z,{default:()=>Y});var i=self.syscall;typeof self>\"u\"&&(self={syscall:()=>{throw new Error(\"Not implemented here\")}});var t=self.syscall;var a={};u(a,{dispatch:()=>j,enableReadOnlyMode:()=>G,filterBox:()=>I,flashNotification:()=>q,getCurrentPage:()=>L,getCursor:()=>S,getSelection:()=>B,getText:()=>C,hidePanel:()=>U,insertAtCursor:()=>V,insertAtPos:()=>K,matchBefore:()=>Q,moveCursor:()=>R,navigate:()=>D,openUrl:()=>$,prompt:()=>z,reloadPage:()=>N,replaceRange:()=>O,save:()=>E,setPage:()=>M,setSelection:()=>T,showPanel:()=>g});function L(){return t(\"editor.getCurrentPage\")}function M(e){return t(\"editor.setPage\",e)}function C(){return t(\"editor.getText\")}function S(){return t(\"editor.getCursor\")}function B(){return t(\"editor.getSelection\")}function T(e,r){return t(\"editor.setSelection\",e,r)}function E(){return t(\"editor.save\")}function D(e,r,n=!1){return t(\"editor.navigate\",e,r,n)}function N(){return t(\"editor.reloadPage\")}function $(e){return t(\"editor.openUrl\",e)}function q(e,r=\"info\"){return t(\"editor.flashNotification\",e,r)}function I(e,r,n=\"\",o=\"\"){return t(\"editor.filterBox\",e,r,n,o)}function g(e,r,n,o=\"\"){return t(\"editor.showPanel\",e,r,n,o)}function U(e){return t(\"editor.hidePanel\",e)}function K(e,r){return t(\"editor.insertAtPos\",e,r)}function O(e,r,n){return t(\"editor.replaceRange\",e,r,n)}function R(e){return t(\"editor.moveCursor\",e)}function V(e){return t(\"editor.insertAtCursor\",e)}function Q(e){return t(\"editor.matchBefore\",e)}function j(e){return t(\"editor.dispatch\",e)}function z(e,r=\"\"){return t(\"editor.prompt\",e,r)}function G(e){return t(\"editor.enableReadOnlyMode\",e)}async function f(e){if(e.length===0){console.log(\"no page name supplied, ignoring navigation\");return}let[r,n]=e.split(\"@\");console.log(`navigating to ${e}`),await a.navigate(r,+n)}var Y=f;return v(Z);})();\n return mod;})()"}}}